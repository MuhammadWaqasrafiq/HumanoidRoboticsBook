"use strict";(self.webpackChunkphysical_ai_humanoid_robotics_book=self.webpackChunkphysical_ai_humanoid_robotics_book||[]).push([[8257],{6075:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"bipedal-locomotion/index","title":"Chapter 08 - Bipedal Locomotion","description":"Master gait generation, balance control, ZMP theory, and whole-body control for stable humanoid walking","source":"@site/docs/bipedal-locomotion/index.mdx","sourceDirName":"bipedal-locomotion","slug":"/bipedal-locomotion/","permalink":"/HumanoidRoboticsBook/docs/bipedal-locomotion/","draft":false,"unlisted":false,"editUrl":"https://github.com/MuhammadWaqasrafiq/HumanoidRoboticsBook/tree/main/docs/bipedal-locomotion/index.mdx","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"id":"index","title":"Chapter 08 - Bipedal Locomotion","sidebar_position":8,"description":"Master gait generation, balance control, ZMP theory, and whole-body control for stable humanoid walking","keywords":["bipedal-locomotion","gait-generation","balance-control","zmp","whole-body-control","humanoid-walking"]},"sidebar":"tutorialSidebar","previous":{"title":"07. Perception Stack","permalink":"/HumanoidRoboticsBook/docs/perception-stack/"},"next":{"title":"09. Dexterous Manipulation","permalink":"/HumanoidRoboticsBook/docs/dexterous-manipulation/"}}');var s=i(4848),o=i(8453);const l={id:"index",title:"Chapter 08 - Bipedal Locomotion",sidebar_position:8,description:"Master gait generation, balance control, ZMP theory, and whole-body control for stable humanoid walking",keywords:["bipedal-locomotion","gait-generation","balance-control","zmp","whole-body-control","humanoid-walking"]},t="Chapter 08: Bipedal Locomotion for Humanoid Robots",c={},a=[{value:"What You&#39;ll Learn",id:"what-youll-learn",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Why Bipedal Locomotion is Hard",id:"why-bipedal-locomotion-is-hard",level:2},{value:"Gait Generation Fundamentals",id:"gait-generation-fundamentals",level:2},{value:"Walking Cycle Phases",id:"walking-cycle-phases",level:3},{value:"Zero Moment Point (ZMP) Theory",id:"zero-moment-point-zmp-theory",level:3},{value:"ZMP-Based Gait Planning",id:"zmp-based-gait-planning",level:3},{value:"Gait Generator Implementation",id:"gait-generator-implementation",level:3},{value:"Balance Control",id:"balance-control",level:2},{value:"Center of Mass (<code>COM</code>) Stabilization",id:"center-of-mass-com-stabilization",level:3},{value:"Balance Recovery Strategies",id:"balance-recovery-strategies",level:3},{value:"Whole-Body Control",id:"whole-body-control",level:2},{value:"Problem Formulation",id:"problem-formulation",level:3},{value:"Quadratic Programming (QP) Controller",id:"quadratic-programming-qp-controller",level:3},{value:"Task Hierarchy",id:"task-hierarchy",level:3},{value:"Locomotion on Uneven Terrain",id:"locomotion-on-uneven-terrain",level:2},{value:"Terrain Sensing",id:"terrain-sensing",level:3},{value:"Adaptive Footstep Planning",id:"adaptive-footstep-planning",level:3},{value:"Balance on Slopes",id:"balance-on-slopes",level:3},{value:"Gait State Machine",id:"gait-state-machine",level:2},{value:"State Definitions",id:"state-definitions",level:3},{value:"Performance Metrics",id:"performance-metrics",level:2},{value:"Success Criteria",id:"success-criteria",level:3},{value:"Debugging Common Failures",id:"debugging-common-failures",level:3},{value:"Integration with Perception and Manipulation",id:"integration-with-perception-and-manipulation",level:2},{value:"Perception-Guided Walking",id:"perception-guided-walking",level:3},{value:"Manipulation While Walking",id:"manipulation-while-walking",level:3},{value:"Further Reading",id:"further-reading",level:2},{value:"Research Papers",id:"research-papers",level:3},{value:"Open-Source Libraries",id:"open-source-libraries",level:3},{value:"ROS 2 Packages",id:"ros-2-packages",level:3},{value:"Summary",id:"summary",level:2}];function d(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"chapter-08-bipedal-locomotion-for-humanoid-robots",children:"Chapter 08: Bipedal Locomotion for Humanoid Robots"})}),"\n",(0,s.jsx)(e.admonition,{title:"Chapter Overview",type:"info",children:(0,s.jsx)(e.p,{children:"Learn how humanoids walk, run, and maintain balance on two legs. Master gait generation algorithms, Zero Moment Point (ZMP) theory, balance controllers, and whole-body control for stable locomotion on flat and uneven terrain."})}),"\n",(0,s.jsx)(e.h2,{id:"what-youll-learn",children:"What You'll Learn"}),"\n",(0,s.jsx)(e.p,{children:"By the end of this chapter, you'll be able to:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u2705 Generate stable walking gaits using ZMP-based trajectory planning"}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 Implement balance control algorithms (",(0,s.jsx)(e.code,{children:"COM"})," stabilization, ankle/hip strategies)"]}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Design whole-body controllers for joint torque computation"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Handle locomotion on flat surfaces at 0.5 m/s walking speed"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Detect and recover from push perturbations within 1.5 seconds"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Implement gait state machines for transitions (stand \u2192 walk \u2192 run)"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Debug common locomotion failures (tipping, foot slip, oscillations)"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Integrate locomotion with perception and manipulation"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(e.p,{children:"Before starting this chapter, you should:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u2705 Complete ",(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.a,{href:"../ros2-fundamentals",children:"Chapter 03: ROS 2 Fundamentals"})})," (topics, actions)"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 Complete ",(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.a,{href:"../urdf-digital-twins",children:"Chapter 04: URDF & Digital Twins"})})," (kinematics, dynamics)"]}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Understand basic control theory (PID, state feedback)"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Have Python 3.10+, ROS 2 Iron, NumPy/SciPy installed"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Have Isaac Sim 2025.1+ for simulation testing"}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{title:"Hardware Requirements (Simulation)",type:"tip",children:(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Minimum:"})," GTX 1660 (6 GB) for Isaac Sim locomotion sim\n",(0,s.jsx)(e.strong,{children:"Recommended:"})," RTX 4060 Ti (16 GB) for real-time physics simulation\n",(0,s.jsx)(e.strong,{children:"Professional:"})," RTX 4070 Ti+ (12-24 GB) for multiple humanoids"]})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"why-bipedal-locomotion-is-hard",children:"Why Bipedal Locomotion is Hard"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Challenges unique to two-legged walking:"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Underactuated system:"})," Fewer contact points than wheels/legs (unstable equilibrium)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Hybrid dynamics:"})," Continuous (swing phase) + discrete (foot contact) transitions"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Balance constraints:"})," Center of Mass (",(0,s.jsx)(e.code,{children:"COM"}),") must stay within support polygon"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Impact forces:"})," Foot strikes generate high forces (2-3x body weight)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Terrain adaptation:"})," Uneven surfaces require continuous adjustment"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Why solve it anyway?"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Navigate human environments (stairs, narrow spaces)"}),"\n",(0,s.jsx)(e.li,{children:"Energy efficiency (walking vs. wheeled on rough terrain)"}),"\n",(0,s.jsx)(e.li,{children:"Social acceptance (human-like appearance)"}),"\n",(0,s.jsx)(e.li,{children:"Manipulation while moving (whole-body coordination)"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"gait-generation-fundamentals",children:"Gait Generation Fundamentals"}),"\n",(0,s.jsx)(e.h3,{id:"walking-cycle-phases",children:"Walking Cycle Phases"}),"\n",(0,s.jsx)(e.p,{children:"A complete walking cycle (stride) has 8 phases:"}),"\n",(0,s.jsx)(e.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e DoubleSupport1: Right heel strike\n    DoubleSupport1 --\x3e SingleSupport_R: Left toe off\n    SingleSupport_R --\x3e DoubleSupport2: Left heel strike\n    DoubleSupport2 --\x3e SingleSupport_L: Right toe off\n    SingleSupport_L --\x3e DoubleSupport1: Right heel strike\n    SingleSupport_L --\x3e [*]\n\n    note right of DoubleSupport1\n        Both feet on ground\n        Weight transfer\n        Duration: 10-20% of cycle\n    end note\n\n    note right of SingleSupport_R\n        Right foot support\n        Left foot swing\n        Duration: 30-40% of cycle\n    end note"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Key parameters:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Step length:"})," 0.3-0.6m (typical adult walking)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Step width:"})," 0.1-0.15m (lateral stability)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Step height:"})," 0.05-0.08m (foot clearance)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Cycle time:"})," 1.0-1.2s (walking), 0.6-0.8s (running)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Double support ratio:"})," 20% (walking), 0% (running - flight phase)"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"zero-moment-point-zmp-theory",children:"Zero Moment Point (ZMP) Theory"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Definition:"})," Point on the ground where the net moment from ground reaction forces is zero."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Physical intuition:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"If ZMP is inside the support polygon \u2192 robot is stable"}),"\n",(0,s.jsx)(e.li,{children:"If ZMP reaches polygon edge \u2192 robot begins to tip"}),"\n",(0,s.jsx)(e.li,{children:"If ZMP is outside polygon \u2192 robot is falling (unrecoverable)"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Mathematical formulation:"})}),"\n",(0,s.jsx)(e.p,{children:"For a humanoid with center of mass at position (x_com, y_com, z_com):"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"ZMP_x = x_com - (z_com / (g + z_com_ddot)) * x_com_ddot\nZMP_y = y_com - (z_com / (g + z_com_ddot)) * y_com_ddot\n"})}),"\n",(0,s.jsx)(e.p,{children:"Where:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"g = 9.81 m/s\xb2"})," (gravity)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"x_com_ddot"}),", ",(0,s.jsx)(e.code,{children:"y_com_ddot"}),", ",(0,s.jsx)(e.code,{children:"z_com_ddot"})," = ",(0,s.jsx)(e.code,{children:"COM"})," accelerations"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Stability condition:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"ZMP \u2208 Support Polygon\n"})}),"\n",(0,s.jsx)(e.p,{children:"For single support (one foot): polygon is foot outline\nFor double support (two feet): polygon is convex hull of both feet"}),"\n",(0,s.jsx)(e.h3,{id:"zmp-based-gait-planning",children:"ZMP-Based Gait Planning"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Goal:"})," Generate ",(0,s.jsx)(e.code,{children:"COM"})," trajectory such that ZMP stays inside support polygon."]}),"\n",(0,s.jsx)(e.mermaid,{value:'flowchart LR\n    subgraph "Input"\n        I1[Desired<br/>Walking Speed]\n        I2[Step Length<br/>Step Width]\n    end\n\n    subgraph "Footstep Planning"\n        F1[Generate<br/>Foot Positions]\n        F2[Compute Support<br/>Polygons]\n    end\n\n    subgraph "COM Trajectory"\n        C1[Preview Control<br/>LIPM Model]\n        C2[Solve for<br/>COM Motion]\n    end\n\n    subgraph "ZMP Verification"\n        Z1[Check ZMP<br/>Inside Polygon]\n        Z2[Adjust if<br/>Needed]\n    end\n\n    subgraph "Output"\n        O1["COM Trajectory<br/>x(t), y(t), z(t)]"]\n        O2["ZMP Trajectory<br/>px(t), py(t)]"]\n    end\n\n    I1 --\x3e F1\n    I2 --\x3e F1\n    F1 --\x3e F2\n    F2 --\x3e C1\n    C1 --\x3e C2\n    C2 --\x3e Z1\n    Z1 --\x3e Z2\n    Z2 --\x3e O1\n    Z2 --\x3e O2\n\n    style C1 fill:#00adef\n    style Z1 fill:#76b900'}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Linear Inverted Pendulum Model (LIPM):"})}),"\n",(0,s.jsx)(e.p,{children:"Simplified humanoid dynamics:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"x_com_ddot = (g / z_com) * (x_com - ZMP_x)\ny_com_ddot = (g / z_com) * (y_com - ZMP_y)\n"})}),"\n",(0,s.jsxs)(e.p,{children:["This allows solving for ",(0,s.jsx)(e.code,{children:"COM"})," trajectory that produces desired ZMP."]}),"\n",(0,s.jsx)(e.h3,{id:"gait-generator-implementation",children:"Gait Generator Implementation"}),"\n",(0,s.jsxs)(e.p,{children:["See ",(0,s.jsx)(e.code,{children:"code-examples/locomotion/gait_generator.py"})," for complete implementation."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Key algorithms:"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Footstep planner:"})," Generate foot positions for N steps ahead"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"ZMP reference:"})," Define desired ZMP trajectory (center of support polygon)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Preview controller:"})," Solve for ",(0,s.jsx)(e.code,{children:"COM"})," trajectory (quadratic optimization)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Swing foot trajectory:"})," Polynomial interpolation for smooth foot motion"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Expected outputs:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"COM"})," trajectory: 100 Hz"]}),"\n",(0,s.jsx)(e.li,{children:"Foot trajectories: 100 Hz"}),"\n",(0,s.jsx)(e.li,{children:"Joint angles: via whole-body inverse kinematics"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"balance-control",children:"Balance Control"}),"\n",(0,s.jsxs)(e.h3,{id:"center-of-mass-com-stabilization",children:["Center of Mass (",(0,s.jsx)(e.code,{children:"COM"}),") Stabilization"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Problem:"})," Real robot deviates from planned trajectory due to:"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Model errors (unmodeled dynamics)"}),"\n",(0,s.jsx)(e.li,{children:"External disturbances (push, uneven terrain)"}),"\n",(0,s.jsx)(e.li,{children:"Sensor noise (IMU drift, encoder backlash)"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Solution:"})," Feedback control to correct ",(0,s.jsx)(e.code,{children:"COM"})," position/velocity."]}),"\n",(0,s.jsx)(e.mermaid,{value:'flowchart TB\n    subgraph "Reference"\n        R1[Planned COM<br/>Trajectory]\n    end\n\n    subgraph "State Estimation"\n        S1[IMU Data]\n        S2[Joint Encoders]\n        S3[Forward Kinematics]\n        S4[Estimated COM<br/>State]\n    end\n\n    subgraph "COM Controller"\n        C1[PID Position<br/>Controller]\n        C2[PID Velocity<br/>Controller]\n        C3[Compute \u0394 COM]\n    end\n\n    subgraph "Whole-Body IK"\n        W1[Map \u0394 COM to<br/>Joint Angles]\n    end\n\n    subgraph "Output"\n        O1[Joint Position<br/>Commands]\n    end\n\n    R1 --\x3e C1\n    S1 --\x3e S3\n    S2 --\x3e S3\n    S3 --\x3e S4\n    S4 --\x3e C1\n    S4 --\x3e C2\n    C1 --\x3e C3\n    C2 --\x3e C3\n    C3 --\x3e W1\n    W1 --\x3e O1\n\n    style C3 fill:#ffcc00\n    style W1 fill:#9966ff'}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"COM PID controller:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"# Position error\ne_pos = com_desired - com_actual\n\n# Velocity error\ne_vel = com_vel_desired - com_vel_actual\n\n# PID output\ndelta_com = Kp * e_pos + Kd * e_vel + Ki * integral(e_pos)\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Typical gains for humanoid (mass ~50kg, height ~1.5m):"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"Kp = 200-400"})," (position gain)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"Kd = 40-80"})," (velocity gain)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"Ki = 5-15"})," (integral gain)"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"balance-recovery-strategies",children:"Balance Recovery Strategies"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"1. Ankle Strategy (Small Perturbations)"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"When:"})," Push force <50N, ",(0,s.jsx)(e.code,{children:"COM"})," stays within support polygon"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"How:"})," Adjust ankle torque to apply corrective moment"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"Ankle_torque = -K_ankle * (theta - theta_desired)\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Advantages:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Fast response (50-100ms)"}),"\n",(0,s.jsx)(e.li,{children:"Minimal energy"}),"\n",(0,s.jsx)(e.li,{children:"No foot movement"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Limitations:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Small workspace (ankle ROM \xb115\xb0)"}),"\n",(0,s.jsx)(e.li,{children:"Cannot handle large disturbances"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"2. Hip Strategy (Medium Perturbations)"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"When:"})," Push force 50-150N, ",(0,s.jsx)(e.code,{children:"COM"})," approaching polygon edge"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"How:"})," Generate large angular momentum with hip motion"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Execution:"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["Detect ",(0,s.jsx)(e.code,{children:"COM"})," near stability boundary"]}),"\n",(0,s.jsx)(e.li,{children:"Swing hip opposite to disturbance"}),"\n",(0,s.jsx)(e.li,{children:"Generate counter-moment"}),"\n",(0,s.jsx)(e.li,{children:"Return to nominal posture"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Advantages:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Larger workspace than ankle strategy"}),"\n",(0,s.jsx)(e.li,{children:"No stepping required"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Limitations:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Slower than ankle (200-400ms)"}),"\n",(0,s.jsx)(e.li,{children:"Higher energy cost"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"3. Stepping Strategy (Large Perturbations)"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"When:"})," Push force >150N, ",(0,s.jsx)(e.code,{children:"COM"})," exiting support polygon"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"How:"})," Take step to create new support polygon under ",(0,s.jsx)(e.code,{children:"COM"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Capture Point Theory:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Capture point:"})," Location where robot must step to stop ",(0,s.jsx)(e.code,{children:"COM"})," motion"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Formula:"})," ",(0,s.jsx)(e.code,{children:"x_capture = x_com + v_com / sqrt(g/z_com)"})]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Execution:"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"Compute capture point"}),"\n",(0,s.jsx)(e.li,{children:"Plan foot placement at capture point"}),"\n",(0,s.jsx)(e.li,{children:"Execute rapid step (swing time <0.3s)"}),"\n",(0,s.jsx)(e.li,{children:"Stabilize in new support"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Recovery time:"})," 0.5-1.5 seconds (meets SC-004 requirement)"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"whole-body-control",children:"Whole-Body Control"}),"\n",(0,s.jsx)(e.h3,{id:"problem-formulation",children:"Problem Formulation"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Goal:"})," Compute joint torques to achieve desired task-space motions (",(0,s.jsx)(e.code,{children:"COM"}),", feet, arms)."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Humanoid has:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"n_q = 30-40 degrees of freedom (joints)"}),"\n",(0,s.jsx)(e.li,{children:"n_c = 6-12 contacts (feet on ground)"}),"\n",(0,s.jsxs)(e.li,{children:["n_t = 12-18 task variables (",(0,s.jsx)(e.code,{children:"COM"}),", swing foot, arms)"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Equations of motion:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"M(q) * q_ddot + C(q, q_dot) * q_dot + G(q) = \u03c4 + J_c^T * F_c\n"})}),"\n",(0,s.jsx)(e.p,{children:"Where:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"M(q)"})," = inertia matrix"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"C(q, q_dot)"})," = Coriolis/centrifugal matrix"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"G(q)"})," = gravity vector"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"\u03c4"})," = joint torques (control input)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"J_c"})," = contact Jacobian"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"F_c"})," = contact forces"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"quadratic-programming-qp-controller",children:"Quadratic Programming (QP) Controller"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Formulate as optimization problem:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"minimize:  ||J * q_ddot - x_ddot_desired||\xb2 + \u03bb * ||\u03c4||\xb2\n\nsubject to:\n    M(q) * q_ddot + h(q, q_dot) = \u03c4 + J_c^T * F_c\n    F_c_min \u2264 F_c \u2264 F_c_max  (friction cone)\n    \u03c4_min \u2264 \u03c4 \u2264 \u03c4_max        (joint limits)\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Variables:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"q_ddot"})," = joint accelerations (n_q)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"\u03c4"})," = joint torques (n_q)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"F_c"})," = contact forces (n_c)"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Implementation:"})," Use OSQP or quadprog solvers (10-20ms on CPU)"]}),"\n",(0,s.jsxs)(e.p,{children:["See ",(0,s.jsx)(e.code,{children:"code-examples/locomotion/whole_body_controller.py"})," for complete QP formulation."]}),"\n",(0,s.jsx)(e.h3,{id:"task-hierarchy",children:"Task Hierarchy"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Priority levels:"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"High priority:"})," Balance (",(0,s.jsx)(e.code,{children:"COM"})," position/velocity)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Medium priority:"})," Swing foot trajectory"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Low priority:"})," Arm posture"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Hierarchical controller:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"# Solve QP with task prioritization\ndef solve_wbc_hierarchical(tasks, contacts):\n    # Tasks sorted by priority (high \u2192 low)\n    tasks_sorted = sorted(tasks, key=lambda t: t.priority, reverse=True)\n\n    # Start with highest priority\n    qp_constraints = [contacts]\n\n    for task in tasks_sorted:\n        # Add task objective\n        qp_objective = task.jacobian @ q_ddot - task.desired_accel\n\n        # Solve QP\n        solution = solve_qp(qp_objective, qp_constraints)\n\n        # Add solution as constraint for next task (nullspace)\n        qp_constraints.append(solution)\n\n    return solution\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"locomotion-on-uneven-terrain",children:"Locomotion on Uneven Terrain"}),"\n",(0,s.jsx)(e.h3,{id:"terrain-sensing",children:"Terrain Sensing"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Perception requirements:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Elevation map (height field)"}),"\n",(0,s.jsx)(e.li,{children:"Surface normals (slope estimation)"}),"\n",(0,s.jsx)(e.li,{children:"Obstacle detection (step height)"}),"\n",(0,s.jsx)(e.li,{children:"Friction coefficient estimation"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Sources:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Point clouds (from Chapter 07)"}),"\n",(0,s.jsx)(e.li,{children:"Stereo depth"}),"\n",(0,s.jsx)(e.li,{children:"Heightmap from SLAM"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"adaptive-footstep-planning",children:"Adaptive Footstep Planning"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Challenges on uneven terrain:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Support polygon is not flat"}),"\n",(0,s.jsx)(e.li,{children:"Foot orientation must match terrain"}),"\n",(0,s.jsx)(e.li,{children:"Step height varies"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"COM"})," trajectory must account for elevation changes"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Algorithm:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"def plan_footstep_uneven(terrain_map, current_pose, target_velocity):\n    # Sample candidate foot positions\n    candidates = sample_foot_positions(current_pose, target_velocity)\n\n    # Evaluate each candidate\n    scores = []\n    for candidate in candidates:\n        # Check terrain height\n        height = terrain_map.get_height(candidate.x, candidate.y)\n\n        # Check slope\n        normal = terrain_map.get_normal(candidate.x, candidate.y)\n        slope = acos(normal.dot([0, 0, 1]))\n\n        # Check obstacles\n        clear = terrain_map.is_collision_free(candidate)\n\n        # Score = weighted sum\n        score = w1 * (1 - slope/max_slope) + \\\n                w2 * clear + \\\n                w3 * proximity_to_target\n\n        scores.append(score)\n\n    # Select best candidate\n    best_footstep = candidates[argmax(scores)]\n\n    return best_footstep\n"})}),"\n",(0,s.jsx)(e.h3,{id:"balance-on-slopes",children:"Balance on Slopes"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"ZMP on inclined terrain:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Support polygon rotates with terrain"}),"\n",(0,s.jsx)(e.li,{children:"Gravity projection changes"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"COM"})," must shift to maintain ZMP inside polygon"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Modified ZMP calculation:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"def compute_zmp_on_slope(com_pos, com_accel, terrain_normal):\n    # Rotate gravity to terrain frame\n    g_rotated = rotate_vector([0, 0, -9.81], terrain_normal)\n\n    # ZMP in terrain frame\n    zmp_x = com_pos[0] - (com_pos[2] / (g_rotated[2] + com_accel[2])) * com_accel[0]\n    zmp_y = com_pos[1] - (com_pos[2] / (g_rotated[2] + com_accel[2])) * com_accel[1]\n\n    return zmp_x, zmp_y\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"gait-state-machine",children:"Gait State Machine"}),"\n",(0,s.jsx)(e.h3,{id:"state-definitions",children:"State Definitions"}),"\n",(0,s.jsx)(e.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e Idle\n    Idle --\x3e Standing: Initialize\n    Standing --\x3e Walking: Start command\n    Walking --\x3e Running: Speed > 1.0 m/s\n    Running --\x3e Walking: Speed < 0.8 m/s\n    Walking --\x3e Standing: Stop command\n    Standing --\x3e Idle: Shutdown\n    Walking --\x3e Balancing: Perturbation\n    Balancing --\x3e Walking: Recovered\n    Balancing --\x3e Falling: Failed recovery\n    Falling --\x3e [*]\n\n    note right of Walking\n        Continuous gait cycle\n        ZMP-based planning\n        Balance monitoring\n    end note\n\n    note right of Balancing\n        Recovery mode\n        Stepping strategy\n        Timeout: 1.5s\n    end note"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"State transitions:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Idle \u2192 Standing:"})," Activate joint position control, lift ",(0,s.jsx)(e.code,{children:"COM"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Standing \u2192 Walking:"})," Start gait generator, first step"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Walking \u2192 Running:"})," Switch to dynamic walking (flight phase)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Walking \u2192 Balancing:"})," Disturbance detected (IMU, force sensors)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Balancing \u2192 Walking:"})," ",(0,s.jsx)(e.code,{children:"COM"})," stabilized, return to nominal gait"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Implementation:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"class GaitStateMachine:\n    def __init__(self):\n        self.state = GaitState.IDLE\n        self.transition_time = 0.3  # seconds\n\n    def update(self, dt, sensors, commands):\n        if self.state == GaitState.WALKING:\n            # Monitor balance\n            if self.detect_perturbation(sensors):\n                self.transition_to(GaitState.BALANCING)\n\n            # Check speed command\n            if commands.velocity > 1.0:\n                self.transition_to(GaitState.RUNNING)\n\n        elif self.state == GaitState.BALANCING:\n            # Attempt recovery\n            if self.is_stable(sensors):\n                self.transition_to(GaitState.WALKING)\n\n            # Timeout check\n            if self.time_in_state() > 1.5:\n                self.transition_to(GaitState.FALLING)\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"performance-metrics",children:"Performance Metrics"}),"\n",(0,s.jsx)(e.h3,{id:"success-criteria",children:"Success Criteria"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"1. Walking Speed:"})," 0.5 m/s on flat terrain (SC-004)"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Measured: Average ",(0,s.jsx)(e.code,{children:"COM"})," velocity over 10 steps"]}),"\n",(0,s.jsx)(e.li,{children:"Target: 0.45-0.55 m/s"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"2. Balance Recovery:"})," Within 1.5 seconds from perturbation (SC-004)"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Test: Apply 100N lateral push"}),"\n",(0,s.jsxs)(e.li,{children:["Measure: Time from push to stable ",(0,s.jsx)(e.code,{children:"COM"})," (< 5cm deviation)"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"3. Stability:"})," No falls over 50 walking cycles"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Metric: Success rate > 95%"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"4. Energy Efficiency:"})," Cost of Transport (COT)"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"COT = Energy / (Weight * Distance)\n"})}),"\n",(0,s.jsx)(e.p,{children:"Target: COT < 0.2 (comparable to human walking)"}),"\n",(0,s.jsx)(e.h3,{id:"debugging-common-failures",children:"Debugging Common Failures"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"1. Tipping Forward/Backward"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Symptoms:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Robot falls in sagittal plane"}),"\n",(0,s.jsx)(e.li,{children:"Cannot recover balance"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Causes:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ZMP reaching front/back edge of foot"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"COM"})," moving too fast"]}),"\n",(0,s.jsx)(e.li,{children:"Incorrect footstep timing"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Solutions:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Reduce walking speed"}),"\n",(0,s.jsx)(e.li,{children:"Increase double support time"}),"\n",(0,s.jsx)(e.li,{children:"Tune ZMP margin (keep 2cm from edge)"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"2. Lateral Instability"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Symptoms:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Swaying side-to-side"}),"\n",(0,s.jsx)(e.li,{children:"Eventually tips laterally"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Causes:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Insufficient step width"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"COM"})," not centered over support polygon"]}),"\n",(0,s.jsx)(e.li,{children:"Hip joint compliance"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Solutions:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Increase step width (0.1m \u2192 0.15m)"}),"\n",(0,s.jsxs)(e.li,{children:["Add lateral ",(0,s.jsx)(e.code,{children:"COM"})," offset during single support"]}),"\n",(0,s.jsx)(e.li,{children:"Increase hip joint stiffness"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"3. Foot Slip"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Symptoms:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Foot slides on contact"}),"\n",(0,s.jsx)(e.li,{children:"Loss of balance"}),"\n",(0,s.jsx)(e.li,{children:"Jerky motion"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Causes:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Excessive ground reaction forces"}),"\n",(0,s.jsx)(e.li,{children:"Low friction surface"}),"\n",(0,s.jsx)(e.li,{children:"Incorrect contact detection"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Solutions:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Limit ",(0,s.jsx)(e.code,{children:"COM"})," acceleration"]}),"\n",(0,s.jsx)(e.li,{children:"Use rubber foot pads"}),"\n",(0,s.jsx)(e.li,{children:"Implement contact force sensing"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"4. Oscillations (Limit Cycles)"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Symptoms:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Robot bounces/oscillates"}),"\n",(0,s.jsx)(e.li,{children:"Cannot settle to stable gait"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Causes:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"PID gains too high"}),"\n",(0,s.jsxs)(e.li,{children:["Coupling between ",(0,s.jsx)(e.code,{children:"COM"})," and swing foot controllers"]}),"\n",(0,s.jsx)(e.li,{children:"Unmodeled leg dynamics"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Solutions:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Reduce Kd gain (damping)"}),"\n",(0,s.jsx)(e.li,{children:"Add low-pass filter on control output"}),"\n",(0,s.jsx)(e.li,{children:"Increase simulation timestep resolution"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"integration-with-perception-and-manipulation",children:"Integration with Perception and Manipulation"}),"\n",(0,s.jsx)(e.h3,{id:"perception-guided-walking",children:"Perception-Guided Walking"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Use case:"})," Navigate to table while avoiding obstacles"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Pipeline:"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Perception:"})," Generate occupancy grid from point cloud"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Path planning:"})," A* or RRT to find collision-free path"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Footstep planning:"})," Place feet along path, respecting obstacles"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Gait execution:"})," Walk along planned footsteps"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Code example:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"# Perception provides obstacles\nobstacles = perception_module.get_obstacles()\n\n# Plan path to goal\npath = path_planner.plan(robot_pose, goal_pose, obstacles)\n\n# Convert path to footsteps\nfootsteps = footstep_planner.generate_from_path(path)\n\n# Execute gait\ngait_controller.execute_footsteps(footsteps)\n"})}),"\n",(0,s.jsx)(e.h3,{id:"manipulation-while-walking",children:"Manipulation While Walking"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Challenges:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Arm motion affects ",(0,s.jsx)(e.code,{children:"COM"})," (dynamic coupling)"]}),"\n",(0,s.jsx)(e.li,{children:"Reduced stability margin (arms not available for balance)"}),"\n",(0,s.jsx)(e.li,{children:"Coordination of locomotion and manipulation timing"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Whole-body coordination:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"def walk_and_manipulate(walk_trajectory, arm_trajectory):\n    # Compute combined COM accounting for arm mass\n    com_total = (m_body * com_body + m_arm * com_arm) / (m_body + m_arm)\n\n    # Adjust ZMP reference to account for arm motion\n    zmp_adjusted = zmp_nominal + K_arm * (arm_accel - arm_accel_planned)\n\n    # Solve whole-body QP with both tasks\n    tasks = [\n        Task(type='COM', jacobian=J_com, priority=1),\n        Task(type='FOOT', jacobian=J_foot, priority=1),\n        Task(type='ARM', jacobian=J_arm, priority=2)\n    ]\n\n    torques = whole_body_controller.solve(tasks)\n\n    return torques\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,s.jsx)(e.h3,{id:"research-papers",children:"Research Papers"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Preview Control of ZMP"})," (Kajita et al. 2003) - ",(0,s.jsx)(e.a,{href:"https://ieeexplore.ieee.org/document/1241826",children:"IEEE Xplore"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Foundational ZMP-based gait generation"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Capture Point"})," (Pratt & Tedrake 2006) - ",(0,s.jsx)(e.a,{href:"https://groups.csail.mit.edu/robotics-center/public_papers/Pratt06.pdf",children:"Paper"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Balance recovery using capture point theory"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Whole-Body Control"})," (Sentis & Khatib 2005) - ",(0,s.jsx)(e.a,{href:"https://journals.sagepub.com/doi/10.1177/0278364905050805",children:"IJRR"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Task-space control with contact constraints"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Terrain-Aware Footstep Planning"})," (Deits & Tedrake 2014) - ",(0,s.jsx)(e.a,{href:"https://groups.csail.mit.edu/robotics-center/public_papers/Deits14.pdf",children:"Paper"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Mixed-integer optimization for footstep planning"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"ATLAS Robot"})," (Kuindersma et al. 2016) - ",(0,s.jsx)(e.a,{href:"https://robotics.sciencemag.org/content/1/1/eaah3857",children:"Science Robotics"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Real-world humanoid locomotion on rough terrain"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"open-source-libraries",children:"Open-Source Libraries"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Humanoid Control:"})," ",(0,s.jsx)(e.a,{href:"https://github.com/stack-of-tasks/pinocchio",children:"Pinocchio"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"QP Solver (OSQP):"})," ",(0,s.jsx)(e.a,{href:"https://github.com/osqp/osqp",children:"OSQP"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Gait Planning:"})," ",(0,s.jsx)(e.a,{href:"https://github.com/stephane-caron/pymanoid",children:"Pymanoid"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Whole-Body Control:"})," ",(0,s.jsx)(e.a,{href:"https://github.com/stack-of-tasks/tsid",children:"TSID"})]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"ros-2-packages",children:"ROS 2 Packages"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Humanoid Common Msgs:"})," ",(0,s.jsx)(e.a,{href:"https://github.com/ros-naoqi/humanoid_msgs",children:"humanoid_msgs"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Walking Controller:"})," ",(0,s.jsx)(e.a,{href:"https://github.com/pal-robotics/talos_walking",children:"talos_walking"})]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(e.p,{children:"In this chapter, you learned:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"Gait generation"})," using ZMP-based trajectory planning"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"Balance control"})," with ",(0,s.jsx)(e.code,{children:"COM"})," stabilization and recovery strategies"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"Whole-body control"})," using quadratic programming"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"Locomotion on uneven terrain"})," with adaptive footstep planning"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"Gait state machines"})," for robust mode transitions"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"Performance metrics"})," for walking speed and balance recovery"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"Debugging strategies"})," for common locomotion failures"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"Integration"})," with perception and manipulation systems"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Next steps:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Chapter 09:"})," Dexterous Manipulation (grasp planning, IK, force control)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Chapter 13:"})," Capstone Project (integrate locomotion + perception + manipulation)"]}),"\n"]}),"\n",(0,s.jsxs)(e.admonition,{title:"Practical Exercise",type:"tip",children:[(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Implement stable walking in Isaac Sim:"})}),(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"Create humanoid URDF with 12-DOF legs"}),"\n",(0,s.jsx)(e.li,{children:"Implement ZMP-based gait generator"}),"\n",(0,s.jsxs)(e.li,{children:["Add ",(0,s.jsx)(e.code,{children:"COM"})," balance controller (PID)"]}),"\n",(0,s.jsx)(e.li,{children:"Test walking at 0.5 m/s on flat terrain"}),"\n",(0,s.jsx)(e.li,{children:"Apply lateral push (100N) and verify recovery < 1.5s"}),"\n",(0,s.jsx)(e.li,{children:"Measure energy efficiency (Cost of Transport)"}),"\n"]}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Time estimate:"})," 4-6 hours\n",(0,s.jsx)(e.strong,{children:"Difficulty:"})," Advanced\n",(0,s.jsx)(e.strong,{children:"Prerequisites:"})," Control theory, dynamics, Isaac Sim"]})]})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>l,x:()=>t});var r=i(6540);const s={},o=r.createContext(s);function l(n){const e=r.useContext(o);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),r.createElement(o.Provider,{value:e},n.children)}}}]);